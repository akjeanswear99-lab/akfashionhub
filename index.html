<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AK FASHION HUB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Hide cart panel off-screen by default */
    #cartPanel {
      position:fixed;
      top:0;
      right:-360px;
      width:360px;
      height:100%;
      background:#fff;
      padding:20px;
      box-shadow:-6px 0 18px rgba(0,0,0,0.18);
      transition:0.28s right ease;
      z-index:10002;
      overflow:auto;
    }
    /* On mobile, move cart completely off-screen */
    @media (max-width:768px){
      #cartPanel { width:100%; right:-100%; }
    }

    body{ margin:0; font-family:Arial, sans-serif; background:#f4f4f4; color:#333; }
    header{
      background: linear-gradient(135deg, #000000, #1a1a1a);
      color:#fff; padding:28px 20px 24px; text-align:center; position:relative; border-bottom:1px solid rgba(255,255,255,0.08);
    }
    header h1{ margin:0; font-size:28px; letter-spacing:2px; font-weight:700; }
    header .tagline{ margin:8px 0 4px; font-size:13px; letter-spacing:1.2px; font-weight:500; opacity:0.85; }
    header .address{ margin:0; font-size:12px; letter-spacing:0.8px; opacity:0.7; }

    .container{ max-width:1200px; margin:auto; padding:20px; }
    .products{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:18px; }
    .card{ background:#fff; border-radius:8px; padding:15px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
    .card img{ width:100%; height:320px; object-fit:contain; border-radius:6px; background:#f7f7f7; }
    .product-img{ width:100%; max-height:500px; object-fit:contain; display:block; }

    .slider{ position:relative; }
    .slider button{ position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); color:#fff; border:none; padding:5px; cursor:pointer; }
    .slider .prev{ left:0; }
    .slider .next{ right:0; }

    select, input, textarea, button{ width:100%; padding:8px; margin-top:6px; box-sizing:border-box; font-size:14px; }
    button{ background:#000; color:#fff; border:none; cursor:pointer; border-radius:6px; padding:10px; }
    button:disabled{ background:gray; cursor:not-allowed; }
    footer{ background:#000; color:#fff; text-align:center; padding:15px; margin-top:40px; width:100vw; position:relative; left:50%; right:50%; margin-left:-50vw; margin-right:-50vw; box-sizing:border-box; }
    footer a{ color:#fff; text-decoration:none; font-weight:600; }
    select option[disabled] { color:#999; }

    .menu-icon{ position:absolute; top:22px; right:20px; cursor:pointer; z-index:10001; }
    .menu-icon span{ display:block; width:26px; height:3px; background:#fff; margin:5px 0; border-radius:3px; }

    /* Toast & alerts */
    #toast{ position: fixed; top: 20px; right: 20px; background: #000; color: #fff; padding: 12px 18px; border-radius: 6px; font-size: 14px; opacity: 0; transform: translateY(-10px); transition: all 0.3s ease; z-index: 10000; pointer-events: none; }
    #toast.show{ opacity: 1; transform: translateY(0); pointer-events: auto; }
    #centerAlert{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20000; background: rgba(0,0,0,0.4); }
    #centerAlert .box{ background:#fff; padding:18px; border-radius:8px; max-width:90%; width:360px; text-align:center; box-shadow:0 8px 30px rgba(0,0,0,0.3); }
    #centerAlert .box p{ margin:0 0 12px 0; font-weight:600; }

    #confirmBox{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:10000; }
    #confirmBox .inner{ background:#fff; padding:20px; width:90%; max-width:320px; border-radius:8px; text-align:center; }

    .terms-scroll{ max-height:60vh; overflow:auto; -webkit-overflow-scrolling: touch; }
  </style>
</head>

<body>
  <div id="cartOverlay"></div>
  <div id="toast" aria-live="polite"></div>

  <header>
    <h1>AK FASHION HUB</h1>
    <div class="tagline">PREMIUM MEN & WOMEN FASHION WEAR</div>
    <div class="address">ADDRESS:- KESHAV NAGAR, SWARG AASHRAM ROAD, HAPUR 245101</div>
    <div onclick="toggleCart()" style="position:absolute; top:22px; left:20px; cursor:pointer; font-size:20px; z-index:10002;">üõí</div>
    <div class="menu-icon" onclick="toggleCart()"><span></span><span></span><span></span></div>
  </header>

  <!-- CART PANEL -->
  <div id="cartPanel" aria-hidden="true">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3>Your Cart</h3>
      <span onclick="toggleCart()" style="cursor:pointer; font-size:22px;">‚úñ</span>
    </div>

    <div id="cartItems"></div>
    <h3 id="total"></h3>

    <div id="checkoutSection">
      <h4>Checkout</h4>
      <input id="name" placeholder="Name">
      <input id="phone" placeholder="10 digit mobile number" maxlength="10" inputmode="numeric" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <textarea id="address" placeholder="House / Shop No, Street / Area, Landmark, City, State - Pincode" rows="4"></textarea>
      <textarea id="note" placeholder="Order Note (Optional)"></textarea>

      <div style="margin-top:10px; font-size:14px;">
        <input type="checkbox" id="terms" style="width:auto;">
        I agree to
        <span style="color:#007bff; cursor:pointer; text-decoration:underline;" onclick="openTermsFromCart()">Terms & Conditions</span>
      </div>
      <button id="placeOrderBtn" onclick="checkout()" style="margin-top:10px;">Place Order (WhatsApp)</button>

      <div id="myOrdersSection" style="display:none; margin-top:12px;">
        <input id="orderPhone" placeholder="Enter phone number" maxlength="10" inputmode="numeric" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
        <input id="orderIdCheck" placeholder="Enter Order ID">
        <button onclick="showMyOrders()">VIEW ORDERS</button>
        <div id="myOrders" style="margin-top:10px;"></div>
      </div>

      <button onclick="openMyOrders()" style="margin-top:12px; background:#fff; color:#000; border:1px solid #000; font-weight:bold; letter-spacing:1px;">MY ORDERS</button>
      <hr>
    </div>
  </div>

  <footer>
    <p>Return Policy: 
      <span style="color:#4da3ff; cursor:pointer; text-decoration:underline;" onclick="openTerms()">(Terms and Conditions Apply)</span>
    </p>
    <p style="margin-bottom:10px; font-size:14px;"><b>Follow us on</b></p>
    <div style="display:flex; justify-content:center; gap:12px; flex-wrap:wrap;">
      <a href="https://www.instagram.com/a_k_fashion_hub_/" target="_blank" style="background:#E1306C; color:#fff; padding:10px 18px; border-radius:25px; text-decoration:none; font-size:14px; font-weight:bold;">Instagram</a>
      <a href="https://share.google/1K75n4058QJ60W7RZ" target="_blank" style="background:#4285F4; color:#fff; padding:10px 18px; border-radius:25px; text-decoration:none; font-size:14px; font-weight:bold;">Google Review</a>
    </div>
  </footer>

  <div id="bottomCartBar" onclick="toggleCart()"></div>

  <script>
    // URLs for Google Apps Script (replace with your actual endpoints)
    const CHECK_STOCK_URL = "...";
    const ORDER_SHEET_URL = "...";
    const UPDATE_STOCK_URL = "...";

    const img1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA...";
    const img2 = img1;
    const img3 = img1;
    const img4 = img1;

    const products = [
      { id:"AKJ001", gender:"Men", name:"Blue Denim Jeans", category:"Jeans",
        price:1999, discount:20, img:[img1], colors:["Blue","Black"],
        sizes:["28","30","32","34","36"], measure:"Waist, Length, Thigh",
        inventory: {
          "28": { "Black": 5, "Blue": 5 },
          "30": { "Black": 5, "Blue": 5 },
          "32": { "Black": 5, "Blue": 5 },
          "34": { "Black": 5, "Blue": 5 },
          "36": { "Black": 5, "Blue": 5 }
        }
      },
      // ... (other products) ...
      { id:"AKF006", gender:"Women", name:"Slim Fit Female Jeans", category:"Jeans",
        price:1699, discount:15, img:[img1,img2], colors:["Blue","Black"],
        sizes:["28","29","30","31","32","33","34"], measure:"Waist, Length, Thigh",
        inventory: {
          "28": { "Blue": 5, "Black": 5 },
          "29": { "Blue": 5, "Black": 5 },
          "30": { "Blue": 5, "Black": 5 },
          "31": { "Blue": 5, "Black": 5 },
          "32": { "Blue": 5, "Black": 5 },
          "33": { "Blue": 5, "Black": 5 },
          "34": { "Blue": 5, "Black": 5 }
        }
      }
    ];

    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let currentFilter = "All";

    function showToast(message){
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 2000);
    }
    function showCenterAlert(message){
      document.getElementById("centerAlertText").innerText = message;
      document.getElementById("centerAlert").style.display = "flex";
    }
    function hideCenterAlert(){
      document.getElementById("centerAlert").style.display = "none";
    }

    function filterProducts(type){
      currentFilter = type;
      renderProducts();
    }

    function renderProducts(){
      const box = document.getElementById("products");
      box.innerHTML = "";
      products.forEach((p,i)=>{
        if(currentFilter !== "All" && p.gender !== currentFilter) return;
        const finalPrice = Math.round(p.price - (p.price * p.discount / 100));
        const imageSrc = p.img.length ? p.img[0] : img1;
        const sizeOptions = p.sizes.map(s => {
          const inv = p.inventory[s];
          const available = inv ? Object.values(inv).some(q => q > 0) : false;
          return `<option value="${s}" ${available ? "" : "disabled"}>${s}${available ? "" : " (Out)"}</option>`;
        }).join("");
        const colorOptions = '<option value="">Select Color</option>' +
                             p.colors.map(c=>`<option value="${c}">${c}</option>`).join("");
        box.innerHTML += `
          <div class="card">
            <div class="slider">
              <img src="${imageSrc}" id="img${i}" class="product-img" onclick="openImage('${imageSrc}')">
            </div>
            <p style="font-size:12px; font-weight:bold; color:#555;">
              ${p.gender}‚Äôs Product
            </p>
            <h3>${p.name}</h3>
            <p>SKU: ${p.id}</p>
            <p>${p.category}</p>
            <p>MRP ‚Çπ${p.price} | ${p.discount}% OFF</p>
            <p><b>‚Çπ${finalPrice}</b></p>
            <p>Measurements: ${p.measure}</p>

            <select id="size${i}" onchange="updateStockMsg(${i})">
              <option value="">Select Size</option>
              ${sizeOptions}
            </select>
            <select id="color${i}" onchange="updateStockMsg(${i})">
              ${colorOptions}
            </select>

            <p id="stockMsg${i}" style="font-size:12px; font-weight:bold;"></p>
            <button id="btn${i}" disabled onclick="addToCart(${i})" aria-label="Add ${p.name} to cart">
              Add to Cart
            </button>
          </div>`;
      });
      updateCartBadge();
    }

    function updateStockMsg(i){
      const sizeVal = document.getElementById("size"+i).value;
      const colorVal = document.getElementById("color"+i).value;
      const p = products[i];
      const msg = document.getElementById("stockMsg"+i);
      const btn = document.getElementById("btn"+i);

      // If size selected, disable out-of-stock colors
      if(sizeVal){
        Array.from(document.getElementById("color"+i).options).forEach(opt => {
          if(opt.value === "") return;
          const stock = (p.inventory[sizeVal] && p.inventory[sizeVal][opt.value]) || 0;
          if(stock <= 0){
            opt.disabled = true; opt.text = opt.value + " (Out)"; opt.style.opacity = 0.5;
          } else {
            opt.disabled = false; opt.text = opt.value; opt.style.opacity = 1;
          }
        });
      }

      if(!sizeVal || !colorVal){
        msg.innerText = ""; btn.disabled = true; return;
      }
      const stock = (p.inventory[sizeVal] && p.inventory[sizeVal][colorVal]) || 0;
      if(stock > 0){
        msg.innerText = `Available: ${stock}`; msg.style.color = "blue"; btn.disabled = false;
      } else {
        msg.innerText = "Out of stock"; msg.style.color = "red"; btn.disabled = true;
      }
    }

    function addToCart(i){
      const size = document.getElementById("size"+i).value;
      const color = document.getElementById("color"+i).value;
      if(!size || !color){ showToast("Select size & color"); return; }
      const p = products[i];
      const stock = (p.inventory[size] && p.inventory[size][color]) || 0;
      if(stock <= 0){ showCenterAlert("This item is currently out of stock."); return; }

      let existing = cart.find(item => item.id===p.id && item.size===size && item.color===color);
      if(existing){
        if(existing.qty < existing.maxStock) existing.qty++;
        else { showCenterAlert("Maximum stock limit reached"); return; }
      } else {
        cart.push({ id:p.id, name:p.name, price:p.price, discount:p.discount, size, color, qty:1, maxStock:stock });
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCart();
      showToast("Item added to cart successfully");
      toggleCart();
    }

    function updateCart(){
      let total = 0;
      const box = document.getElementById("cartItems");
      box.innerHTML = "";
      cart.forEach((c,index)=>{
        const price = Math.round(c.price - (c.price * c.discount / 100));
        total += price * c.qty;
        box.innerHTML += `
          <div style="border-bottom:1px solid #ddd; padding:10px 0; margin-bottom:10px;">
            <b>${c.name}</b><br>
            Size: ${c.size} | Color: ${c.color}<br>
            Qty: <button onclick="changeQty(${index},-1)">‚àí</button> <b>${c.qty}</b> <button onclick="changeQty(${index},1)">+</button><br>
            Amount: ‚Çπ${price * c.qty}<br><br>
            <button style="background:red;" onclick="askRemove(${index})">Remove Item</button>
          </div>`;
      });
      document.getElementById("total").innerText = "Total: ‚Çπ" + total;
      updateCartBadge();
      updateBottomBar(total);
    }

    function changeQty(index,diff){
      const item = cart[index];
      if(diff === -1){ item.qty--; if(item.qty <= 0) cart.splice(index,1); }
      if(diff === 1){
        if(item.qty < item.maxStock) item.qty++;
        else { showCenterAlert("Maximum stock limit reached"); return; }
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCart();
    }

    let removeIndex = null;
    function askRemove(index){
      removeIndex = index;
      document.getElementById("confirmText").innerText = `Are you sure you want to remove "${cart[index].name}"?`;
      document.getElementById("confirmBox").style.display = "flex";
    }
    function confirmYes(){
      cart.splice(removeIndex,1);
      localStorage.setItem("cart", JSON.stringify(cart));
      document.getElementById("confirmBox").style.display = "none";
      showToast("Item removed from cart");
      updateCart();
      renderProducts();
    }
    function confirmNo(){ document.getElementById("confirmBox").style.display = "none"; }

    function generateOrderId(){
      const now = new Date();
      const date = now.getFullYear().toString() + String(now.getMonth()+1).padStart(2,"0") + String(now.getDate()).padStart(2,"0");
      const rand = Math.floor(1000 + Math.random()*9000);
      return `AKFH-${date}-${rand}`;
    }

    async function checkout(){
      if(!document.getElementById("terms").checked){ alert("Please accept Terms & Conditions"); return; }
      const n = document.getElementById("name").value.trim();
      const p = document.getElementById("phone").value.trim();
      const a = document.getElementById("address").value.trim();
      const note = document.getElementById("note").value.trim();
      if(p.length!==10){ alert("Enter valid 10 digit mobile number"); return; }
      if(!n||!p||!a||cart.length===0){ showToast("Fill all details and add items to cart"); return; }

      // Check stock on server for each item
      for(let item of cart){
        try{
          const res = await fetch(CHECK_STOCK_URL, {
            method:"POST", headers:{"Content-Type":"application/json"},
            body: JSON.stringify({ action:"CHECK_STOCK", sku: item.id, size: item.size, color: item.color })
          });
          const result = await res.json();
          if(!result.allowed){ showCenterAlert(`${item.name} (${item.size}, ${item.color}) is OUT OF STOCK`); return; }
        } catch(e){ alert("Stock check failed. Try again."); return; }
      }

      const orderId = generateOrderId();
      let totalQty = 0, totalAmount = 0;
      cart.forEach(c => { totalQty += c.qty; totalAmount += Math.round(c.price - (c.price*c.discount/100)) * c.qty; });

      // Save order for "My Orders"
      let allOrders = JSON.parse(localStorage.getItem("ordersByPhone")) || {};
      if(!allOrders[p]) allOrders[p] = [];
      allOrders[p].push({
        orderId: orderId,
        date: new Date().toLocaleString(),
        items: cart.map(c => ({ name:c.name, size:c.size, color:c.color, qty:c.qty })),
        total: totalAmount,
        status: "Order Received"
      });
      localStorage.setItem("ordersByPhone", JSON.stringify(allOrders));

      // Send order to Google Sheets (non-blocking)
      fetch(ORDER_SHEET_URL, {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
          orderId:orderId, name:n, phone:p, address:a,
          products: cart.map(c => `${c.name} | SKU:${c.id} | Size:${c.size} | Color:${c.color} | Qty:${c.qty}`).join(" || "),
          totalQty:totalQty, totalAmount:totalAmount
        })
      }).catch(()=>{});

      // Update stock on server and locally
      await decrementStockForOrder(cart);

      // Open WhatsApp with order summary
      let msg = `AK FASHION HUB\nOrder ID: ${orderId}\nKeshav Nagar, Hapur 245101\n\n`;
      cart.forEach(c => {
        const price = Math.round(c.price - (c.price * c.discount / 100));
        msg += `${c.name}\nSKU:${c.id}\nSize:${c.size}\nColor:${c.color}\n‚Çπ${price}\nQty: ${c.qty}\n\n`;
      });
      msg += `Customer: ${n}\nPhone: ${p}\nAddress: ${a}\nNote: ${note}`;
      window.open("https://wa.me/919599497909?text=" + encodeURIComponent(msg));

      alert("Order Placed Successfully!\nYour Order ID: " + orderId);
      cart = []; localStorage.removeItem("cart");
      updateCart(); renderProducts();
    }

    async function decrementStockForOrder(orderCart){
      for(const item of orderCart){
        // Update local inventory
        const prod = products.find(p=>p.id===item.id);
        if(prod && prod.inventory[item.size]){
          prod.inventory[item.size][item.color] = Math.max(0, prod.inventory[item.size][item.color] - item.qty);
        }
        // Send update to server
        try{
          await fetch(UPDATE_STOCK_URL, {
            method:"POST", headers:{"Content-Type":"application/json"},
            body: JSON.stringify({ action:"UPDATE_STOCK", sku:item.id, size:item.size, color:item.color, qty:item.qty })
          });
        } catch(e){}
      }
      renderProducts(); showToast("Stock updated.");
    }

    function updateCartBadge(){
      let badge = document.getElementById("cartCount");
      if(!badge){
        const cartIcon = document.querySelector('[onclick="toggleCart()"]');
        badge = document.createElement("span");
        badge.id = "cartCount";
        badge.style.background = "red";
        badge.style.color = "#fff";
        badge.style.borderRadius = "50%";
        badge.style.padding = "2px 6px";
        badge.style.fontSize = "12px";
        badge.style.marginLeft = "6px";
        cartIcon.appendChild(badge);
      }
      const totalQty = cart.reduce((s,c) => s + c.qty, 0);
      badge.innerText = totalQty;
      const total = cart.reduce((s,c) => s + Math.round(c.price - (c.price*c.discount/100))*c.qty, 0);
      updateBottomBar(total);
    }

    function updateBottomBar(total){
      let bar = document.getElementById("bottomCartBar");
      if(!bar){
        bar = document.createElement("div");
        bar.id = "bottomCartBar";
        bar.style.position = "fixed";
        bar.style.bottom = "0";
        bar.style.left = "0";
        bar.style.width = "100%";
        bar.style.background = "#000";
        bar.style.color = "#fff";
        bar.style.padding = "12px";
        bar.style.display = "none";
        bar.style.justifyContent = "space-between";
        bar.style.alignItems = "center";
        bar.style.zIndex = "9999";
        bar.onclick = toggleCart;
        document.body.appendChild(bar);
      }
      if(window.innerWidth < 768 && cart.length > 0){
        bar.style.display = "flex";
        bar.innerHTML = `üõí View Cart (${cart.reduce((s,c) => s+c.qty,0)}) <b>‚Çπ${total}</b>`;
      } else {
        bar.style.display = "none";
      }
    }

    function toggleCart(){
      const cartPanel = document.getElementById("cartPanel");
      const overlay = document.getElementById("cartOverlay");
      if(cartPanel.style.right === "0px"){
        cartPanel.style.right = window.innerWidth < 768 ? "-100%" : "-360px";
        overlay.style.display = "none";
      } else {
        cartPanel.style.right = "0px";
        overlay.style.display = "block";
      }
    }

    function openImage(src){
      const modal = document.createElement("div");
      modal.style.cssText = "position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; display:flex; align-items:center; justify-content:center;";
      modal.innerHTML = `<div style="overflow:auto; max-width:100%; max-height:100%;">
        <img src="${src}" id="zoomImg" style="max-width:100%; max-height:100%; transform-origin:center center; cursor:zoom-in;">
      </div>`;
      let scale = 1;
      const img = modal.querySelector("#zoomImg");
      img.onwheel = e => { e.preventDefault(); scale += e.deltaY * -0.001; scale = Math.min(Math.max(1, scale), 4); img.style.transform = `scale(${scale})`; };
      img.ondblclick = () => { scale = (scale===1?2:1); img.style.transform = `scale(${scale})`; };
      modal.onclick = e => { if(e.target === modal) modal.remove(); };
      document.body.appendChild(modal);
    }

    function openTerms(){
      const modal = document.createElement("div");
      modal.style.cssText = "position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; display:flex; align-items:center; justify-content:center;";
      modal.innerHTML = `<div style="background:#fff; padding:20px; max-width:720px; max-height:85%; overflow:auto; border-radius:8px;">
        <h3>Terms & Conditions ‚Äì AK FASHION HUB</h3>
        <div class="terms-scroll" style="font-size:14px; line-height:1.6;">
          <!-- Terms content here -->
          ‚Ä¢ <b>Delivery Time:</b> Orders will be delivered within <b>4‚Äì6 working days</b>...<br><br>
          <!-- ...more terms text... -->
          ‚Ä¢ <b>Agreement:</b> By placing an order, the customer confirms they have read, understood, and agreed to all terms.
        </div>
        <button id="agreeInlineBtn" style="width:100%; margin-top:10px;">I Agree</button>
      </div>`;
      modal.onclick = e => { if(e.target === modal) modal.remove(); };
      document.body.appendChild(modal);
      document.getElementById("agreeInlineBtn").onclick = () => { document.getElementById("terms").checked = true; modal.remove(); };
    }

    function openTermsFromCart(){
      const modal = document.createElement("div");
      modal.style.cssText = "position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:20000; display:flex; align-items:center; justify-content:center;";
      modal.innerHTML = `<div style="background:#fff; width:90%; max-width:640px; max-height:80%; border-radius:8px; padding:15px; display:flex; flex-direction:column;">
        <h3 style="text-align:center;margin:0 0 8px;">Terms & Conditions ‚Äì AK FASHION HUB</h3>
        <div id="termsBox" class="terms-scroll" style="flex:1; border:1px solid #ddd; padding:10px; font-size:14px; line-height:1.6;">
          <!-- Terms content (same as above) -->
          ‚Ä¢ <b>Delivery Time:</b> Orders will be delivered within <b>4‚Äì6 working days</b>...<br><br>
          <!-- ...more terms text... -->
        </div>
        <div id="scrollHint" style="font-size:12px;text-align:center;color:#666;">‚¨áÔ∏è Scroll down to enable</div>
        <button id="agreeBtn" disabled style="margin-top:10px; padding:10px; background:gray; color:#fff; border:none; border-radius:4px; cursor:not-allowed;">I Agree</button>
      </div>`;
      document.body.appendChild(modal);
      const box = modal.querySelector("#termsBox"), btn = modal.querySelector("#agreeBtn"), hint = modal.querySelector("#scrollHint");
      if(box.scrollHeight <= box.clientHeight + 2){ btn.disabled = false; btn.style.background = "#000"; btn.style.cursor = "pointer"; hint.style.display = "none"; }
      box.addEventListener("scroll", ()=>{
        if(box.scrollTop + box.clientHeight >= box.scrollHeight - 5){
          btn.disabled = false; btn.style.background = "#000"; btn.style.cursor = "pointer"; hint.style.display = "none";
        }
      });
      btn.onclick = () => { document.getElementById("terms").checked = true; modal.remove(); };
      modal.onclick = e => { if(e.target === modal) modal.remove(); };
    }

    function openMyOrders(){
      document.getElementById("checkoutSection").style.display = "none";
      document.getElementById("myOrdersSection").style.display = "block";
      // Insert "Back to Checkout" button if not already present
      if(!document.getElementById("backToCheckoutBtn")){
        const mySection = document.getElementById("myOrdersSection");
        const backBtn = document.createElement("button");
        backBtn.id = "backToCheckoutBtn";
        backBtn.textContent = "‚Üê Back to Checkout";
        backBtn.style.marginTop = "6px";
        backBtn.style.background = "#000";
        backBtn.style.color = "#fff";
        backBtn.onclick = backToCheckout;
        mySection.insertBefore(backBtn, mySection.firstChild);
      }
    }
    function backToCheckout(){
      document.getElementById("myOrdersSection").style.display = "none";
      document.getElementById("checkoutSection").style.display = "block";
    }

    function showMyOrders(){
      const phone = document.getElementById("orderPhone").value.trim();
      const orderIdInput = document.getElementById("orderIdCheck").value.trim();
      const box = document.getElementById("myOrders");
      const allOrders = JSON.parse(localStorage.getItem("ordersByPhone")) || {};
      const orders = allOrders[phone];
      if(!orders){
        box.innerHTML = "<p>Invalid phone number or Order ID</p>"; return;
      }
      const matched = orders.some(o => o.orderId === orderIdInput);
      if(!matched){
        box.innerHTML = "<p>Invalid phone number or Order ID</p>"; return;
      }
      let html = "";
      orders.forEach(o => {
        html += `
          <div style="border:1px solid #ddd; padding:8px; margin-bottom:8px;">
            <b>Order ID:</b> ${o.orderId}<br>
            <b>Date:</b> ${o.date}<br>
            <b>Status:</b> ${o.status}<br>
            <b>Total:</b> ‚Çπ${o.total}<br>
            <b>Items:</b><br>
            ${o.items.map(i => `‚Ä¢ ${i.name} (${i.size}, ${i.color}) √ó ${i.qty}`).join("<br>")}
          </div>`;
      });
      box.innerHTML = html;
    }

    // Limit note to 30 words
    document.getElementById("note").addEventListener("input", function(){
      const words = this.value.trim().split(/\s+/);
      if(words.length > 30){
        this.value = words.slice(0,30).join(" ");
      }
    });

    // Initialize
    renderProducts();
    updateCart();
    updateCartBadge();
  </script>
</body>
</html>
